CREATE DATABASE IF NOT EXISTS iExPLORE;

USE iExPLORE;

CREATE TABLE users (
user_id int(11) NOT NULL,
username varchar(255) NOT NULL,
password varchar(255) NOT NULL,
created_at timestamp NOT NULL DEFAULT current_timestamp()
email varchar(255) NOT NULL,
PRIMARY KEY(user_id),
ON UPDATE CASCADE ON DELETE CASCADE
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE administrators(
administrator_id int(11) NOT NULL,
id int(11) NOT NULL,
admin_role role ,
username varchar(255) NOT NULL,
password varchar(255) NOT NULL,
PRIMARY KEY(administrator_id)
FOREIGN KEY(id) REFERENCES users(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE members (
member_id int(11) NOT NULL,
username varchar(255) NOT NULL,
password int(11) NOT NULL,
ON UPDATE CASCADE ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE destinations (
trip_id int(11) NOT NULL,
destination_name VARCHAR(255) NOT NULL,
description TEXT,
price DECIMAL(10,2) NOT NULL,
available_seats INT NOT NULL,
start_date DATE NOT NULL,
end_date DATE NOT NULL,
PRIMARY KEY (trip_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE booking(
booking_id INT(11) NOT NULL AUTO_INCREMENT,
user_id INT(11) NOT NULL,
trip_id INT(11) NOT NULL,
status ENUM('confirmed', 'pending', 'cancelled') NOT NULL DEFAULT 'pending',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (booking_id),
FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;



CREATE TABLE TripPlan(
plan_id INT(11) NOT NULL AUTO_INCREMENT,
user_id INT(11) NOT NULL,
trip_id INT(11) NOT NULL,
itinerary TEXT NOT NULL,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (plan_id),
FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE TripReview(
review_id INT(11) NOT NULL AUTO_INCREMENT,
user_id INT(11) NOT NULL,
trip_id INT(11) NOT NULL,
rating INT CHECK(rating BETWEEN 1 AND 5),
comment TEXT,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (review_id),
FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE TripApplication(
application_id INT(11) NOT NULL AUTO_INCREMENT,
user_id INT(11) NOT NULL,
trip_id INT(11) NOT NULL,
status ENUM('approved', 'pending', 'rejected') NOT NULL DEFAULT 'pending',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (application_id),
FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE Notifications(
notification_id INT(11) NOT NULL AUTO_INCREMENT,
user_id INT(11) NOT NULL,
message TEXT NOT NULL,
status ENUM('read', 'unread') NOT NULL DEFAULT 'unread',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (notification_id),
FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE Preferences(
preference_id INT(11) NOT NULL AUTO_INCREMENT,
user_id INT(11) NOT NULL,
preferred_destination VARCHAR(255),
preferred_budget DECIMAL(10,2),
PRIMARY KEY (preference_id),
FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE Wishlist(
wishlist_id INT(11) NOT NULL AUTO_INCREMENT,
user_id INT(11) NOT NULL,
trip_id INT(11) NOT NULL,
PRIMARY KEY (wishlist_id),
FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE Offers_and_Discounts(
offer_id INT(11) NOT NULL AUTO_INCREMENT,
trip_id INT(11) NOT NULL,
discount_percentage DECIMAL(5,2) NOT NULL,
valid_until DATE NOT NULL,
PRIMARY KEY (offer_id),
FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;



import mysql.connector

def create_database():
    conn = mysql.connector.connect(
        host="localhost",
        user="root",  # Î‘Î»Î»Î¬Î¾Ï„Îµ Ï„Î¿ Î±Î½ Î­Ï‡ÎµÏ„Îµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ Ï‡ÏÎ®ÏƒÏ„Î·
        password="your_password"
    )
    cursor = conn.cursor()

    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
    cursor.execute("CREATE DATABASE IF NOT EXISTS iExPLORE")
    cursor.execute("USE iExPLORE")

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Users
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS users (
        user_id INT(11) NOT NULL AUTO_INCREMENT,
        username VARCHAR(255) NOT NULL UNIQUE,
        password VARCHAR(255) NOT NULL,
        created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
        email VARCHAR(255) NOT NULL UNIQUE,
        PRIMARY KEY (user_id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Administrators
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS administrators (
        administrator_id INT(11) NOT NULL AUTO_INCREMENT,
        id INT(11) NOT NULL,
        admin_role ENUM('superadmin', 'moderator') NOT NULL,
        username VARCHAR(255) NOT NULL UNIQUE,
        password VARCHAR(255) NOT NULL,
        PRIMARY KEY (administrator_id),
        FOREIGN KEY (id) REFERENCES users(user_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Members
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS members (
        member_id INT(11) NOT NULL AUTO_INCREMENT,
        username VARCHAR(255) NOT NULL UNIQUE,
        password VARCHAR(255) NOT NULL,
        PRIMARY KEY (member_id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Destinations
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS destinations (
        trip_id INT(11) NOT NULL AUTO_INCREMENT,
        destination_name VARCHAR(255) NOT NULL,
        description TEXT,
        price DECIMAL(10,2) NOT NULL,
        available_seats INT NOT NULL,
        start_date DATE NOT NULL,
        end_date DATE NOT NULL,
        PRIMARY KEY (trip_id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Booking
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS booking (
        booking_id INT(11) NOT NULL AUTO_INCREMENT,
        user_id INT(11) NOT NULL,
        trip_id INT(11) NOT NULL,
        status ENUM('confirmed', 'pending', 'cancelled') NOT NULL DEFAULT 'pending',
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (booking_id),
        FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
        FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ TripPlan
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS TripPlan (
        plan_id INT(11) NOT NULL AUTO_INCREMENT,
        user_id INT(11) NOT NULL,
        trip_id INT(11) NOT NULL,
        itinerary TEXT NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (plan_id),
        FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
        FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ TripReview
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS TripReview (
        review_id INT(11) NOT NULL AUTO_INCREMENT,
        user_id INT(11) NOT NULL,
        trip_id INT(11) NOT NULL,
        rating INT CHECK(rating BETWEEN 1 AND 5),
        comment TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (review_id),
        FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
        FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ TripApplication
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS TripApplication (
        application_id INT(11) NOT NULL AUTO_INCREMENT,
        user_id INT(11) NOT NULL,
        trip_id INT(11) NOT NULL,
        status ENUM('approved', 'pending', 'rejected') NOT NULL DEFAULT 'pending',
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (application_id),
        FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
        FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Notifications
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS Notifications (
        notification_id INT(11) NOT NULL AUTO_INCREMENT,
        user_id INT(11) NOT NULL,
        message TEXT NOT NULL,
        status ENUM('read', 'unread') NOT NULL DEFAULT 'unread',
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (notification_id),
        FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Preferences
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS Preferences (
        preference_id INT(11) NOT NULL AUTO_INCREMENT,
        user_id INT(11) NOT NULL,
        preferred_destination VARCHAR(255),
        preferred_budget DECIMAL(10,2),
        PRIMARY KEY (preference_id),
        FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Wishlist
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS Wishlist (
        wishlist_id INT(11) NOT NULL AUTO_INCREMENT,
        user_id INT(11) NOT NULL,
        trip_id INT(11) NOT NULL,
        PRIMARY KEY (wishlist_id),
        FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
        FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    # Î Î¯Î½Î±ÎºÎ±Ï‚ Offers_and_Discounts
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS Offers_and_Discounts (
        offer_id INT(11) NOT NULL AUTO_INCREMENT,
        trip_id INT(11) NOT NULL,
        discount_percentage DECIMAL(5,2) NOT NULL,
        valid_until DATE NOT NULL,
        PRIMARY KEY (offer_id),
        FOREIGN KEY (trip_id) REFERENCES destinations(trip_id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
    """)

    conn.commit()
    conn.close()
    print("Database created successfully!")

# Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î¿Ï… script
if __name__ == "__main__":
    create_database()

#pip install mysql-connector-python



import mysql.connector
import bcrypt

# Î£ÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
def connect_db():
    return mysql.connector.connect(
        host="localhost",
        user="root",  # Î‘Î»Î»Î±Î³Î® Î±Î½ Î­Ï‡ÎµÏ„Îµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ Ï‡ÏÎ®ÏƒÏ„Î·
        password="your_password",
        database="iExPLORE"
    )

# ğŸ”¹ Î•Î³Î³ÏÎ±Ï†Î® Ï‡ÏÎ®ÏƒÏ„Î·
def register(username, password, email):
    conn = connect_db()
    cursor = conn.cursor()

    # Hash Ï„Î¿Ï… ÎºÏ‰Î´Î¹ÎºÎ¿Ï
    hashed_password = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())

    try:
        cursor.execute("INSERT INTO users (username, password, email) VALUES (%s, %s, %s)", 
                       (username, hashed_password, email))
        conn.commit()
        print(" Î•Î³Î³ÏÎ±Ï†Î® ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚!")
    except mysql.connector.Error as err:
        print(f" Î£Ï†Î¬Î»Î¼Î±: {err}")
    finally:
        cursor.close()
        conn.close()

# ğŸ”¹ Î£ÏÎ½Î´ÎµÏƒÎ· Ï‡ÏÎ®ÏƒÏ„Î·
def login(username, password):
    conn = connect_db()
    cursor = conn.cursor(dictionary=True)

    cursor.execute("SELECT * FROM users WHERE username = %s", (username,))
    user = cursor.fetchone()

    if user and bcrypt.checkpw(password.encode('utf-8'), user["password"].encode('utf-8')):
        print(" Î£ÏÎ½Î´ÎµÏƒÎ· ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚!")
        return True
    else:
        print(" Î›Î¬Î¸Î¿Ï‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚.")
        return False

    cursor.close()
    conn.close()

# Î”Î¿ÎºÎ¹Î¼Î­Ï‚
if __name__ == "__main__":
    # Î”Î¿ÎºÎ¹Î¼Î® ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚
    register("testuser", "testpassword", "testuser@example.com")

    # Î”Î¿ÎºÎ¹Î¼Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚
    login("testuser", "testpassword")


#pip install bcrypt mysql-connector-python

#Î‘Î½ ÏŒÎ»Î± Î´Î¿Ï…Î»ÎµÏÎ¿Ï…Î½ ÏƒÏ‰ÏƒÏ„Î¬, Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„Î¿ÏÎ½ Î¼Î·Î½ÏÎ¼Î±Ï„Î± ÏŒÏ€Ï‰Ï‚:
Î•Î³Î³ÏÎ±Ï†Î® ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚!
Î£ÏÎ½Î´ÎµÏƒÎ· ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚!



import tkinter as tk
from tkinter import messagebox
import mysql.connector
import bcrypt

# ğŸ”¹ Î£ÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î· Î²Î¬ÏƒÎ·
def connect_db():
    return mysql.connector.connect(
        host="localhost",
        user="root",
        password="your_password",
        database="iExPLORE"
    )

# ğŸ”¹ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·
def login():
    username = username_entry.get()
    password = password_entry.get()

    conn = connect_db()
    cursor = conn.cursor(dictionary=True)
    
    cursor.execute("SELECT * FROM users WHERE username = %s", (username,))
    user = cursor.fetchone()

    if user and bcrypt.checkpw(password.encode('utf-8'), user["password"].encode('utf-8')):
        messagebox.showinfo(" Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±", "Î£ÏÎ½Î´ÎµÏƒÎ· ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚!")
        show_dashboard(user)
    else:
        messagebox.showerror(" Î£Ï†Î¬Î»Î¼Î±", "Î›Î¬Î¸Î¿Ï‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚.")

    cursor.close()
    conn.close()

# ğŸ”¹ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Dashboard
def show_dashboard(user):
    dashboard = tk.Toplevel(root)
    dashboard.title("Dashboard")
    dashboard.geometry("300x200")

    tk.Label(dashboard, text=f" Î§ÏÎ®ÏƒÏ„Î·Ï‚: {user['username']}", font=("Arial", 14)).pack(pady=5)
    tk.Label(dashboard, text=f" Email: {user['email']}", font=("Arial", 12)).pack(pady=5)
    tk.Label(dashboard, text=f" Î•Î³Î³ÏÎ±Ï†Î®: {user['created_at']}", font=("Arial", 12)).pack(pady=5)

# ğŸ”¹ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± GUI Î¼Îµ Tkinter
root = tk.Tk()
root.title("Î£ÏÎ½Î´ÎµÏƒÎ·")
root.geometry("300x200")

tk.Label(root, text="ÎŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·:").pack()
username_entry = tk.Entry(root)
username_entry.pack()

tk.Label(root, text="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚:").pack()
password_entry = tk.Entry(root, show="*")
password_entry.pack()

tk.Button(root, text="Î£ÏÎ½Î´ÎµÏƒÎ·", command=login).pack(pady=10)

root.mainloop()
